(load "src/prelude.valk")

(def {aio} (aio/await (aio/start)))

(print "Testing aio/within timeout debug...")

(def {slow-handle} (aio/sleep aio 200))
(def {timeout-handle} (aio/within slow-handle 50))

(print "Handles created, starting timer...")

; Use aio/then to properly wait for completion
(aio/then timeout-handle
  (\ {result} {
    (print "SUCCESS callback - this should not happen")
    (print result)
    (aio/stop aio)
  })
  (\ {error} {
    (print "ERROR callback - timeout should trigger this")
    (print "Error:" error)
    (aio/stop aio)
  }))

(print "Event loop starting...")