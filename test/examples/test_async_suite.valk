; Async Test Suite
; Basic tests for async/await functionality (without loading full async lib)

(load "src/prelude.valk")
(load "src/modules/test.valk")

; ============================================================================
; Basic Async Tests
; ============================================================================

(test/define "async-shift-reset-basic"
  {do
    (def {result} (async-reset {
      (async-shift {k} {(k 42)})
    }))
    (== result 42)
  })

(test/define "async-shift-reset-computation"
  {do
    (def {result} (async-reset {
      (def {x} (async-shift {k} {(k 10)}))
      (* x 2)
    }))
    (== result 20)
  })

(test/define "async-sequential-shifts"
  {do
    (def {result} (async-reset {
      (def {a} (async-shift {k} {(k 5)}))
      (def {b} (async-shift {k} {(k 10)}))
      (+ a b)
    }))
    (== result 15)
  })

(test/define "async-nested-computation"
  {do
    (def {double} (\ {x k} {(k (* x 2))}))
    (def {result} (async-reset {
      (async-shift {k} {(double 21 k)})
    }))
    (== result 42)
  })

; Run all async tests
(test/run)
