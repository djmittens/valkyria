; Tail Call Optimization Test Suite
;
; NOTE: TCO is NOT currently implemented in the tree-walking interpreter.
; Proper TCO requires either:
;   1. An explicit evaluation stack (stack machine) instead of C's call stack
;   2. LLVM backend with tail call attribute
; This will be implemented when we add the LLVM compilation backend.

(load "src/prelude.valk")
(load "src/modules/test.valk")
(test/suite "TCO Tests")
(test/skip "TCO requires stack machine or LLVM backend")

; ============================================================================
; Correctness Tests
; These verify recursive functions produce correct results.
; ============================================================================

(test/define "tco-countdown-result"
  {do
    (def {countdown} (\ {n} {
      (if (<= n 0)
        {0}
        {(countdown (- n 1))})
    }))
    (== (countdown 100) 0)
  })

(test/define "tco-accumulator-result"
  {do
    (def {sum} (\ {n acc} {
      (if (<= n 0)
        {acc}
        {(sum (- n 1) (+ acc n))})
    }))
    (== (sum 100 0) 5050)
  })

(test/define "tco-factorial-result"
  {do
    (def {factorial} (\ {n acc} {
      (if (<= n 1)
        {acc}
        {(factorial (- n 1) (* n acc))})
    }))
    (== (factorial 5 1) 120)
  })

; Run all TCO tests
(test/run {})
