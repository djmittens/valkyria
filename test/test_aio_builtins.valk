; Test suite for AIO metrics builtins
; Tests: aio/metrics, aio/metrics-json, aio/metrics-prometheus

(load "src/prelude.valk")
(load "src/modules/test.valk")

(test/run (list
  (test "aio/metrics returns metrics qexpr"
    {do
    (def {sys} (aio/start))
    (def {result} (aio/metrics sys))
    (aio/stop sys)
    (not (nil? result))
  })
  (test "aio/metrics-json returns valid result"
    {do
    (def {sys} (aio/start))
    (def {result} (aio/metrics-json sys))
    (aio/stop sys)
    (and (not (nil? result)) (not (error? result)))
  })
  (test "aio/metrics-prometheus returns valid result"
    {do
    (def {sys} (aio/start))
    (def {result} (aio/metrics-prometheus sys))
    (aio/stop sys)
    (and (not (nil? result)) (not (error? result)))
  }))
  {:suite-name "AIO Metrics Builtins Tests"})
