(load "src/prelude.valk")

(printf "Tracing select with nth parameters:\n\n")

; Set up the exact scenario from nth
(fun {test-nth n _l} {
  (printf "Inside test-nth, n=%ld, _l=" n)
  (print _l)
  
  ; Build the select arguments manually
  (= {branch1} {(<= n 0) (error "Invalid")})
  (= {branch2} {(== n 1) (fst _l)})
  (= {branch3} {otherwise "fallback"})
  
  (printf "\nBranch 2: ")
  (print branch2)
  
  (printf "fst of branch2: ")
  (= {cond} (fst branch2))
  (print cond)
  
  (printf "snd of branch2: ")
  (= {expr} (snd branch2))
  (print expr)
  
  (printf "Type of expr: %ld\n" (type expr))
  
  ; Return the expr
  expr
})

(= {lst} {10 20 30})
(= {result} (test-nth 1 lst))
(printf "\nFinal result: ")
(print result)

(shutdown 0)
