; Tests for read-file builtin and debug assets loading
; Run with: ./build/valk test/test_read_file.valk

(load "src/prelude.valk")
(load "src/modules/test.valk")

(test/suite "read-file Tests")

; Test: read-file content is not empty
(test/define "read-file-content-not-empty"
  {do
    (= {content} (read-file "src/modules/aio/debug/head.html"))
    (test/assert (> (len content) 0) "read-file should return non-empty content")
  })

; Test: read-file loads CSS correctly
(test/define "read-file-loads-css"
  {do
    (= {css} (read-file "src/modules/aio/debug/style.css"))
    (test/assert (> (len css) 100) "style.css should have substantial content")
  })

; Test: read-file loads JS correctly
(test/define "read-file-loads-js"
  {do
    (= {js} (read-file "src/modules/aio/debug/script.js"))
    (test/assert (> (len js) 100) "script.js should have substantial content")
  })

; Test: str concatenation of multiple files works
(test/define "str-concat-files"
  {do
    (= {path} "src/modules/aio/debug/")
    (= {head} (read-file (str path "head.html")))
    (= {style} (read-file (str path "style.css")))
    (= {body} (read-file (str path "body.html")))
    (= {script} (read-file (str path "script.js")))
    (= {footer} (read-file (str path "footer.html")))
    (= {total} (str head style body script footer))
    ; Total should be sum of all parts
    (= {expected-len} (+ (len head) (len style) (len body) (len script) (len footer)))
    (test/assert-eq expected-len (len total) "concatenated length should match sum of parts")
  })

; Test: debug.valk module loads successfully
(test/define "debug-module-loads"
  {do
    (load "src/modules/aio/debug.valk")
    (test/assert (> (len aio/debug-html-content) 1000) "debug HTML content should be loaded")
  })

; Run all tests
(test/run)
