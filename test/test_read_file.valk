; Tests for read-file builtin and debug assets loading
; Run with: ./build/valk test/test_read_file.valk

(load "src/prelude.valk")
(load "src/modules/test.valk")

; Test: read-file content is not empty

; Test: read-file loads CSS correctly

; Test: read-file loads JS correctly

; Test: str concatenation of multiple files works

; Test: debug.valk module loads successfully

; Run all tests
(test/run (list
  (test "read-file-content-not-empty"
    {do
    (= {content} (read-file "src/modules/aio/debug/head.html"))
    (test/assert (> (len content) 0) "read-file should return non-empty content")
  })
  (test "read-file-loads-css"
    {do
    (= {css} (read-file "src/modules/aio/debug/style.css"))
    (test/assert (> (len css) 100) "style.css should have substantial content")
  })
  (test "read-file-loads-js"
    {do
    (= {js} (read-file "src/modules/aio/debug/script.js"))
    (test/assert (> (len js) 100) "script.js should have substantial content")
  })
  (test "debug-module-loads"
    {do
    (load "src/modules/aio/debug.valk")
    (test/assert (> (len aio/debug-html-content) 1000) "debug HTML content should be loaded")
  })
  (test "str-concat-files"
    {do
    (= {fpath} "src/modules/aio/debug/")
    (= {head-html} (read-file (str fpath "head.html")))
    (= {style-css} (read-file (str fpath "style.css")))
    (= {body-html} (read-file (str fpath "body.html")))
    (= {script-js} (read-file (str fpath "script.js")))
    (= {footer-html} (read-file (str fpath "footer.html")))
    (= {total} (str head-html style-css body-html script-js footer-html))
    (= {expected-len} (+ (len head-html) (len style-css) (len body-html) (len script-js) (len footer-html)))
    (test/assert-eq expected-len (len total) "concatenated length should match sum of parts")
  }))
  {:suite-name "read-file Tests"})
