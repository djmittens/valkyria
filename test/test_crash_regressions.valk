; Crash Regression Test Suite
; Tests for bugs that previously caused crashes
; These are CRITICAL regressions that must never return

(load "src/prelude.valk")
(load "src/modules/test.valk")

; ============================================================================
; Do Block with test/define Crashes
; ============================================================================

(test/define "crash-regression-do-in-test-define"
  ; Previously crashed when using do inside test/define
  ; Source: debug_crash_define.valk
  {do
    (def {result} true)
    (== result true)
  })

(test/define "crash-regression-simple-do"
  ; Previously crashed with simple do blocks
  ; Source: debug_crash_minimal.valk
  {do
    (def {x} 5)
    (== x 5)
  })

(test/define "crash-regression-multiple-do-expressions"
  ; Test that do with multiple expressions doesn't crash
  ; Source: debug_crash_minimal.valk
  {do
    (def {a} 1)
    (def {b} 2)
    (== (+ a b) 3)
  })

(test/define "crash-regression-do-with-assignment"
  ; Test do blocks with variable assignment
  ; Source: debug_crash_minimal.valk
  {do
    (= {x} 10)
    (= {y} 20)
    (== (+ x y) 30)
  })

(test/define "crash-regression-nested-do-blocks"
  ; Test nested do blocks don't cause crashes
  {do
    (def {outer} (do
      (def {inner} 42)
      inner))
    (== outer 42)
  })

; Run all crash regression tests
(test/run {})
