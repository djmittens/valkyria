(load "src/prelude.valk")

(def {aio} (aio/await (aio/start)))

(print "Creating slow sleep handles")
(def {h1} (aio/sleep aio 500))
(def {h2} (aio/sleep aio 600))

(print "Creating aio/all handle")
(def {ah} (aio/all (list h1 h2)))

(print "Chaining on all handle")
(aio/then ah (\ {results} {
  (print (str "All completed with: " results))
  (aio/stop aio)
}))

(print "Calling aio/run")
(aio/run aio)
(print "Done")
