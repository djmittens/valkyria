(load "src/prelude.valk")

(def {aio} (aio/await (aio/start)))
(printf "1. Created aio\n")
(def {h1} (aio/sleep aio 10))
(printf "2. Created h1\n")
(def {h2} (aio/sleep aio 20))
(printf "3. Created h2\n")
(def {h3} (aio/sleep aio 30))
(printf "4. Created h3\n")
(def {all-h} (aio/all (list h1 h2 h3)))
(printf "5. Created all-h\n")
(aio/then all-h (\ {results} {
  (printf "6. All completed with %d results\n" (len results))
  (aio/stop aio)
}))
(printf "7. Set up then\n")
(aio/run aio)
(printf "8. Done\n")
