{"t": "spec", "spec": "deprecate-atoms.md"}
{"t": "task", "id": "t-hfr17p", "spec": "deprecate-atoms.md", "name": "Refactor test framework to remove atoms", "s": "p", "notes": "Refactor src/modules/test.valk to replace all atom usage with functional patterns: 1) Remove 4 global atoms (*test-async-pending-atom*, *test-async-passed-atom*, *test-async-failed-atom*, *test-async-timed-out-atom*), 2) Replace polling loop (lines ~532-559) with aio/all to wait for test completion, 3) Replace per-test timeout atom with aio/race pattern, 4) Have each test return {:status :pass/:fail/:timeout} result, 5) Aggregate results after aio/all completes", "accept": "make test passes and grep -c atom src/modules/test.valk returns 0", "deps": ["t-g6kd61"], "priority": "high"}
{"t": "task", "id": "t-hnzo57", "spec": "deprecate-atoms.md", "name": "Refactor SSE stress tests to remove atoms", "s": "p", "notes": "Refactor test/stress/test_sse_concurrency_short.valk and test/stress/test_sse_concurrency.valk to replace 6 atoms each with functional patterns: 1) Replace counter atoms (connections-opened, connections-closed, events-received, errors-count) with aio/all to collect results from all connections, 2) Replace active-connections atom with aio/semaphore for rate limiting, 3) Replace test-running atom with aio/race for clean shutdown, 4) Return results from each connection and aggregate after aio/all", "accept": "All stress tests pass and grep -c atom for both files returns 0", "deps": ["t-hfr17p"], "priority": "high"}
{"t": "task", "id": "t-huv4b6", "spec": "deprecate-atoms.md", "name": "Update http2/client-request callers to use aio/then", "s": "d", "notes": "Although http2/client-request already returns handles, need to verify all callers use the handle-based API correctly. Search for any legacy callback-based usage patterns and update them to use aio/then with the returned handle. This is a verification task - the API is already correct", "accept": "All http2/client-request usages follow the handle pattern with aio/then", "done_at": "e947aab", "priority": "medium"}
{"t": "task", "id": "t-h3mrv9", "spec": "deprecate-atoms.md", "name": "Remove atom implementation and tests", "s": "p", "notes": "Phase 5 - Breaking change: 1) Remove valk_atom_t struct and all atom builtin functions from src/parser.c (lines ~4040-4100), 2) Remove atom builtin registrations from valk_lenv_put_builtins (lines ~5209-5213), 3) Delete test/test_atom_builtins.valk file, 4) Remove atom error tests from test/test_parser_errors.c (lines ~1195-1215), 5) Verify no atom usage remains in any .valk files", "accept": "(atom 1) returns Unknown function atom error and make test passes", "deps": ["t-hnzo57"], "priority": "medium"}
{"t": "task", "id": "t-u9ur69", "spec": "deprecate-atoms.md", "name": "Implement aio/semaphore builtin", "s": "p", "notes": "Create aio/semaphore builtin in src/aio/aio_combinators.c following existing aio/all pattern: 1) Add valk_semaphore_t struct with max_permits, available permits, and queue of waiting handles, 2) Implement aio/semaphore (n permits), aio/semaphore-acquire (returns future), aio/semaphore-release (releases permit), 3) Register builtins in valk_lenv_put_builtins, 4) Create test/test_aio_semaphore.valk with tests for acquire/release/blocking behavior", "accept": "aio/semaphore 3 creates semaphore, acquire/release work correctly, and make test passes"}
{"t": "task", "id": "t-veg2v6", "spec": "deprecate-atoms.md", "name": "Implement stream/closed builtin", "s": "p", "notes": "Add stream/closed builtin to src/aio/http2/stream/aio_stream_builtins.c following existing stream patterns: 1) Implement function that returns future completing with :closed when stream closes, 2) Hook into existing stream close events to trigger completion, 3) Register builtin in appropriate location, 4) Add tests to test/test_sse_builtins.valk for stream/closed behavior", "accept": "stream/closed returns handle that completes when stream closes and tests pass", "priority": "medium"}
{"t": "task", "id": "t-vnjftv", "spec": "deprecate-atoms.md", "name": "Refactor http2/client-request to return handle", "s": "p", "notes": "Modify http2/client-request in src/aio/http2/aio_http2_client.c to return handle instead of callback: 1) Remove callback parameter from function signatures, 2) Create async handle with valk_async_handle_new, 3) Store handle in request context, 4) In response completion callback, call valk_async_handle_complete with response, 5) Return handle immediately to Lisp, 6) Update both http2/client-request and http2/client-request-with-headers", "accept": "http2/client-request returns handle and can be used with aio/then", "deps": ["t-u9ur69"], "priority": "high"}
{"t": "accept", "id": "t-g6kd61", "done_at": "f391f6b", "reason": ""}
