{"t": "spec", "spec": "deprecate-atoms.md"}
{"t": "task", "id": "t-aio-all-settled", "spec": "deprecate-atoms.md", "name": "Add aio/all-settled combinator", "s": "p", "notes": "Add (aio/all-settled handles) that: 1) Waits for ALL handles to complete (no fail-fast), 2) Returns list of {:status :ok :value v} or {:status :error :error e} for each handle, 3) Never fails - always returns results list. Useful when you want all results regardless of individual failures.", "accept": "aio/all-settled works, test exists, make test passes", "priority": "medium"}
{"t": "task", "id": "t-aio-retry", "spec": "deprecate-atoms.md", "name": "Add aio/retry combinator", "s": "p", "notes": "Add (aio/retry aio fn opts) that: 1) Calls fn to get handle, 2) On failure, retries according to opts {:max-attempts n :backoff :exponential/:linear/:none :base-ms ms}, 3) Returns handle that completes with first success or final failure. Common pattern for network operations.", "accept": "aio/retry works with backoff, test exists, make test passes", "priority": "medium"}
{"t": "task", "id": "t-aio-never", "spec": "deprecate-atoms.md", "name": "Add aio/never combinator", "s": "p", "notes": "Add (aio/never aio) that returns a handle that never completes. Useful for aio/race patterns: (aio/race (list (aio/never aio) (stream/closed s))) means 'wait forever unless stream closes'. Simple implementation: create handle, never complete it.", "accept": "aio/never works, test exists, make test passes", "priority": "low"}
{"t": "task", "id": "t-aio-traverse", "spec": "deprecate-atoms.md", "name": "Add aio/traverse combinator", "s": "p", "notes": "Add (aio/traverse list fn) as sugar for (aio/all (map fn list)). Maps async fn over list then collects results. Common pattern: (aio/traverse urls fetch) instead of (aio/all (map fetch urls)).", "accept": "aio/traverse works, test exists, make test passes", "priority": "low"}
{"t": "task", "id": "t-interval", "spec": "deprecate-atoms.md", "name": "Refactor aio/interval to return cancellable handle", "s": "p", "notes": "Currently aio/interval returns a number (interval ID). Refactor to return a handle: 1) Change valk_aio_interval to return valk_lval_handle, 2) Support aio/cancel on interval handles to stop the interval, 3) Handle completes when interval stops (via :stop return or aio/cancel), 4) Keep backward compat: :stop from callback still works.", "accept": "aio/interval returns handle, aio/cancel stops it, make test passes", "priority": "high"}
{"t": "task", "id": "t-ly03eq", "spec": "deprecate-atoms.md", "name": "Refactor test framework to remove atoms", "s": "p", "notes": "Refactor src/modules/test.valk: 1) Remove 4 global atoms (*test-async-pending-atom*, etc), 2) Each test returns {:status :pass/:fail/:timeout} via handle, 3) Use aio/all to collect all test results, 4) Use aio/within for per-test timeout instead of atom coordination, 5) Aggregate results after aio/all completes", "accept": "make test passes and grep -c atom src/modules/test.valk returns 0", "deps": ["t-aio-within"], "priority": "high"}
{"t": "task", "id": "t-sse-refactor", "spec": "deprecate-atoms.md", "name": "Refactor SSE stress tests to use aio/cancel", "s": "p", "notes": "Refactor test/stress/test_sse_concurrency*.valk to remove atoms: 1) Replace closed atom + polling with aio/cancel on stream close, 2) Replace counter atoms with aio/all result collection, 3) Each connection returns {:events n :status ok}", "accept": "grep -c atom test/stress/test_sse_concurrency*.valk returns 0, tests pass", "deps": ["t-interval"], "priority": "medium"}
{"t": "task", "id": "t-miq4pp", "spec": "deprecate-atoms.md", "name": "Remove atom implementation and tests", "s": "p", "notes": "Breaking change: 1) Remove valk_atom_t and all atom builtins from src/parser.c, 2) Remove registrations from valk_lenv_put_builtins, 3) Delete test/test_atom_builtins.valk, 4) Remove atom error tests from test/test_parser_errors.c", "accept": "(atom 1) returns Unknown function atom error and make test passes", "deps": ["t-ly03eq", "t-sse-refactor"], "priority": "medium"}
{"t": "task", "id": "t-4l8k3z", "spec": "deprecate-atoms.md", "name": "Remove aio/deferred functions", "s": "p", "notes": "Phase 1: Remove aio/deferred APIs from src/aio/aio_combinators.c: 1) Remove valk_aio_deferred_new, valk_aio_deferred_complete, valk_aio_deferred_fail functions, 2) Remove their builtin registrations from parser.c, 3) These are anti-pattern APIs that expose handle completion to Lisp code", "accept": "(aio/deferred) returns Unknown function error, make build and make test pass", "priority": "high"}
{"t": "accept", "id": "t-g6kd61", "done_at": "f391f6b", "reason": ""}
{"t": "reject", "id": "t-huv4b6", "done_at": "e947aab", "reason": "Not all http2/client-request usages follow the handle pattern with aio/then."}
{"t": "accept", "id": "t-u9ur69", "done_at": "50a9603", "reason": ""}
{"t": "accept", "id": "t-veg2v6", "done_at": "8db5cdf", "reason": ""}
{"t": "accept", "id": "t-2gi2zz", "done_at": "4804ce8", "reason": ""}
{"t": "accept", "id": "t-2m2v3z", "done_at": "45cb699", "reason": ""}
{"t": "accept", "id": "t-g3srfg", "done_at": "16b8d7a", "reason": ""}
{"t": "accept", "id": "t-rm-sem", "done_at": "f25a51e", "reason": "aio/semaphore builtins removed"}
{"t": "accept", "id": "t-rm-deferred", "done_at": "6dc600e", "reason": "aio/deferred returns Unknown function error, make test passes", "name": "Remove aio/deferred builtins"}
{"t": "accept", "id": "t-aio-within", "done_at": "a6c6db1", "reason": "aio/within works, test exists, make test passes", "name": "Add aio/within combinator"}
