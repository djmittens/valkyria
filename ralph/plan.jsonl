{"t": "spec", "spec": "deprecate-atoms.md"}
{"t": "task", "id": "t-rfsv", "spec": "deprecate-atoms.md", "name": "Implement aio/semaphore builtin", "s": "p", "notes": "Create semaphore with n permits. Returns handle. File: src/aio/aio_combinators.c. Register in valk_register_async_handle_builtins()", "accept": "build/valk -e \"(aio/semaphore aio 3)\" returns handle", "deps": ["t-h8dm"], "priority": "high"}
{"t": "task", "id": "t-u4ky", "spec": "deprecate-atoms.md", "name": "Implement aio/semaphore-acquire builtin", "s": "p", "notes": "Returns future that completes when permit acquired. File: src/aio/aio_combinators.c", "accept": "Acquire returns pending future when no permits available", "deps": ["t-rfsv"], "priority": "high"}
{"t": "task", "id": "t-dru7", "spec": "deprecate-atoms.md", "name": "Implement aio/semaphore-release builtin", "s": "p", "notes": "Release permit, wake next waiter if any. Returns nil. File: src/aio/aio_combinators.c", "accept": "Release wakes blocked acquires", "deps": ["t-u4ky"], "priority": "high"}
{"t": "task", "id": "t-ke4q", "spec": "deprecate-atoms.md", "name": "Create test/test_aio_semaphore.valk", "s": "p", "notes": "Test acquire/release/blocking behavior. Test: permits exhausted then released, multiple waiters, immediate acquire when permits available", "accept": "build/valk test/test_aio_semaphore.valk passes", "deps": ["t-dru7"], "priority": "high"}
{"t": "task", "id": "t-28nk", "spec": "deprecate-atoms.md", "name": "Implement stream/closed builtin", "s": "p", "notes": "Returns future that completes with :closed when stream closes. File: src/aio/http2/stream/aio_stream_builtins.c. Stream state enum already exists.", "accept": "stream/closed returns future that completes on stream close", "priority": "high"}
{"t": "task", "id": "t-uemb", "spec": "deprecate-atoms.md", "name": "Add stream/closed tests to test/test_sse_builtins.valk", "s": "p", "notes": "Test stream/closed returns future, completes with :closed when stream closes. Use existing SSE test patterns.", "accept": "grep stream/closed test/test_sse_builtins.valk finds tests, make test passes", "deps": ["t-28nk"], "priority": "high"}
{"t": "task", "id": "t-oqxd", "spec": "deprecate-atoms.md", "name": "Refactor src/modules/test.valk to use aio/all for result collection", "s": "p", "notes": "Replace *test-async-passed-atom*, *test-async-failed-atom*, *test-async-timed-out-atom*, *test-async-pending-atom* with aio/all + reduce. Each test returns result struct.", "accept": "grep -c atom.*async src/modules/test.valk returns 0, make test passes", "deps": ["t-ke4q"], "priority": "high"}
{"t": "task", "id": "t-mpxy", "spec": "deprecate-atoms.md", "name": "Refactor src/modules/test.valk to use aio/race for timeouts", "s": "p", "notes": "Replace per-test timed-out atom with aio/race between test and timeout. Replace *test-suite-timed-out* with suite-level race.", "accept": "grep -c atom src/modules/test.valk returns 0, make test passes", "deps": ["t-oqxd"], "priority": "high"}
{"t": "task", "id": "t-fqq5", "spec": "deprecate-atoms.md", "name": "Refactor test/test_sse_concurrency_short.valk to remove atoms", "s": "p", "notes": "Use aio/semaphore for rate limiting (MAX_ACTIVE=5), aio/all for result collection, stream/closed for stream state. 8 atoms to remove.", "accept": "grep -c atom test/test_sse_concurrency_short.valk returns 0, test passes", "deps": ["t-ke4q", "t-uemb"], "priority": "high"}
{"t": "task", "id": "t-vwhg", "spec": "deprecate-atoms.md", "name": "Refactor test/stress/test_sse_concurrency_short.valk to remove atoms", "s": "p", "notes": "Same pattern as test/test_sse_concurrency_short.valk. 8 atoms to remove.", "accept": "grep -c atom test/stress/test_sse_concurrency_short.valk returns 0, test passes", "deps": ["t-fqq5"], "priority": "high"}
{"t": "task", "id": "t-eafj", "spec": "deprecate-atoms.md", "name": "Refactor test/stress/test_sse_concurrency.valk to remove atoms", "s": "p", "notes": "Same pattern as test/test_sse_concurrency_short.valk. 8 atoms to remove.", "accept": "grep -c atom test/stress/test_sse_concurrency.valk returns 0", "deps": ["t-vwhg"], "priority": "high"}
{"t": "task", "id": "t-stas", "spec": "deprecate-atoms.md", "name": "Add deprecation warnings to atom builtins in parser.c", "s": "p", "notes": "Add VALK_WARN to valk_builtin_atom, valk_builtin_atom_get, valk_builtin_atom_set, valk_builtin_atom_add, valk_builtin_atom_sub. Lines 4044-4100.", "accept": "build/valk -e \"(atom 1)\" prints deprecation warning to stderr, make test passes", "deps": ["t-mpxy", "t-eafj"], "priority": "high"}
{"t": "task", "id": "t-o640", "spec": "deprecate-atoms.md", "name": "Remove valk_atom_t struct and builtin functions from parser.c", "s": "p", "notes": "Remove lines 4040-4100 (struct + 5 functions). Phase 5 breaking change.", "accept": "grep -c valk_atom_t src/parser.c returns 0, make build succeeds", "deps": ["t-stas"], "priority": "high"}
{"t": "task", "id": "t-jjc3", "spec": "deprecate-atoms.md", "name": "Remove atom builtin registrations from parser.c", "s": "p", "notes": "Remove lines 5215-5219 where atom, atom/get, atom/set!, atom/add!, atom/sub! are registered.", "accept": "grep -c \"atom\" src/parser.c returns 0 (for builtin strings), make build succeeds", "deps": ["t-o640"], "priority": "high"}
{"t": "task", "id": "t-lkuq", "spec": "deprecate-atoms.md", "name": "Delete test/test_atom_builtins.valk", "s": "p", "notes": "File has 16 tests for atom API. All tests obsolete after atom removal.", "accept": "ls test/test_atom_builtins.valk fails", "deps": ["t-jjc3"], "priority": "high"}
{"t": "task", "id": "t-m5mf", "spec": "deprecate-atoms.md", "name": "Remove atom error tests from test/test_parser_errors.c", "s": "p", "notes": "Remove test_atom_get_wrong_type, test_atom_set_wrong_type, test_atom_add_wrong_type, test_atom_sub_wrong_type. Lines 1185-1223.", "accept": "grep -c atom test/test_parser_errors.c returns 0, make test passes", "deps": ["t-lkuq"], "priority": "high"}
{"t": "task", "id": "t-owol", "spec": "deprecate-atoms.md", "name": "Final verification: no atom references remain", "s": "p", "notes": "Verify: grep -r atom src/*.valk test/*.valk | grep -v atomic | wc -l returns 0. build/valk -e \"(atom 1)\" returns Unknown function error.", "accept": "make test passes, all acceptance criteria from spec phases 1-5 verified", "deps": ["t-m5mf"], "priority": "medium"}
