{"t": "spec", "spec": "deprecate-atoms.md"}
{"t": "task", "id": "t-5ywar0", "spec": "deprecate-atoms.md", "name": "Implement stream/closed builtin", "s": "p", "notes": "Add stream/closed to src/aio/http2/stream/aio_stream_builtins.c: 1) Implement valk_builtin_stream_closed(stream) that returns handle, 2) Handle completes with :closed when stream closes, 3) Hook into existing stream close events, 4) Register builtin. This replaces callback-based stream/on-close for monadic composition with aio/race.", "accept": "stream/closed returns handle that completes with :closed when stream closes"}
{"t": "task", "id": "t-6e05zz", "spec": "deprecate-atoms.md", "name": "Add tests for stream/closed", "s": "p", "notes": "Add stream/closed tests to test/test_sse_builtins.valk: 1) Test handle completion when stream closes, 2) Test aio/race with stream/closed for cancellation pattern, 3) Verify :closed symbol returned", "accept": "test/test_sse_builtins.valk tests pass for stream/closed", "deps": ["t-5ywar0"]}
{"t": "task", "id": "t-ly03eq", "spec": "deprecate-atoms.md", "name": "Refactor test framework to remove atoms", "s": "p", "notes": "Refactor src/modules/test.valk: 1) Remove 4 global atoms (*test-async-pending-atom*, etc), 2) Each test returns {:status :pass/:fail/:timeout} via handle, 3) Use aio/all to collect all test results, 4) Use aio/race for per-test timeout instead of atom coordination, 5) Aggregate results after aio/all completes", "accept": "make test passes and grep -c atom src/modules/test.valk returns 0", "deps": ["t-5ywar0"], "priority": "high"}
{"t": "task", "id": "t-l4x4yb", "spec": "deprecate-atoms.md", "name": "Refactor SSE stress tests to remove atoms", "s": "p", "notes": "Refactor test/stress/test_sse_concurrency_short.valk and test_sse_concurrency.valk: 1) Replace counter atoms with aio/all result collection - each connection returns {:events n :status ok}, 2) For rate limiting use chunked execution (batches of MAX_ACTIVE) not semaphores, 3) Replace test-running atom with aio/race timeout, 4) Aggregate results after aio/all", "accept": "All stress tests pass and grep -c atom for both files returns 0", "deps": ["t-ly03eq"], "priority": "high"}
{"t": "task", "id": "t-mbu8vo", "spec": "deprecate-atoms.md", "name": "Update deprecation warnings in atom builtins", "s": "p", "notes": "Update deprecation warnings in src/parser.c atom builtins to say: \"atom is deprecated: use aio/all and aio/race instead\" (the current message incorrectly mentions aio/semaphore which we are removing)", "accept": "build/valk -e (atom 1) prints updated deprecation warning mentioning aio/all and aio/race", "deps": ["t-l4x4yb"]}
{"t": "task", "id": "t-miq4pp", "spec": "deprecate-atoms.md", "name": "Remove atom implementation and tests", "s": "p", "notes": "Phase 5 - Breaking change: 1) Remove valk_atom_t and all atom builtins from src/parser.c, 2) Remove registrations from valk_lenv_put_builtins, 3) Delete test/test_atom_builtins.valk, 4) Remove atom error tests from test/test_parser_errors.c", "accept": "(atom 1) returns Unknown function atom error and make test passes", "deps": ["t-mbu8vo"], "priority": "medium"}
{"t": "accept", "id": "t-g6kd61", "done_at": "f391f6b", "reason": ""}
{"t": "reject", "id": "t-huv4b6", "done_at": "e947aab", "reason": "Not all http2/client-request usages follow the handle pattern with aio/then. Several files still use the legacy callback-based API instead of the new handle-based API. Found at least 3 test files (test/stress/test_large_download_stress.valk, test/test_sse_reconnect_minimal.valk, test/test_sse_diagnostics_endpoint.valk) that still use the old callback pattern instead of (aio/then (http2/client-request ...) callback)."}
{"t": "accept", "id": "t-u9ur69", "done_at": "50a9603", "reason": ""}
{"t": "accept", "id": "t-veg2v6", "done_at": "8db5cdf", "reason": ""}
{"t": "accept", "id": "t-2gi2zz", "done_at": "4804ce8", "reason": ""}
{"t": "accept", "id": "t-2m2v3z", "done_at": "45cb699", "reason": ""}
{"t": "accept", "id": "t-g3srfg", "done_at": "16b8d7a", "reason": ""}
{"t": "accept", "id": "t-rm-sem", "done_at": "f25a51e", "reason": "aio/semaphore returns Unknown function error, make build succeeds, make test passes", "name": "Remove aio/semaphore builtins"}
