{"t": "spec", "spec": "deprecate-atoms.md"}
{"t": "task", "id": "t-l7va", "spec": "deprecate-atoms.md", "name": "Remove timed-out atom from *test-run-one-with-timeout*", "s": "p", "notes": "Lines 117, 131 use a local timed-out atom to track per-test timeout state. Replace with aio/race pattern between test execution and timeout sleep. The function *test-timeout-cb* (lines 85-91) also uses timeout-atom parameter.", "accept": "grep -c timed-out src/modules/test.valk returns 0 (excluding string occurrences in output messages), make test passes", "priority": "high", "reject": "grep -c timed-out src/modules/test.valk returns 34 (not 0). Line 124 in *test-run-one-with-timeout* still contains functional code '(plist/set ctx :timed-out (+ (plist/get ctx :timed-out) 1))' that tracks timeout counts - this is not a string occurrence but actual atom-like state tracking."}
{"t": "task", "id": "t-xpho", "spec": "deprecate-atoms.md", "name": "Remove *test-suite-timed-out* global atom", "s": "p", "notes": "Lines 9, 79, 305, 339 use *test-suite-timed-out* global atom. Replace with suite-level aio/race pattern. The atom is set in *test-suite-timeout-cb* and reset at start of test/run and test/run-with-timeout.", "accept": "grep -c test-suite-timed-out src/modules/test.valk returns 0, make test passes", "deps": ["t-y5b5", "t-l7va"], "priority": "high"}
{"t": "task", "id": "t-6nak", "spec": "deprecate-atoms.md", "name": "Verify test.valk has zero atoms and tests pass", "s": "p", "notes": "Final verification: grep -c atom src/modules/test.valk returns 0 AND make test passes.", "accept": "grep -c atom src/modules/test.valk returns 0, make test passes", "deps": ["t-xpho"], "priority": "high"}
{"t": "task", "id": "t-wt8v", "spec": "deprecate-atoms.md", "name": "Refactor test/test_sse_concurrency_short.valk to remove atoms", "s": "p", "notes": "Use aio/semaphore for rate limiting (MAX_ACTIVE=5), aio/all for result collection, stream/closed for stream state. 8 atoms to remove.", "accept": "grep -c atom test/test_sse_concurrency_short.valk returns 0, test passes", "priority": "high"}
{"t": "task", "id": "t-62en", "spec": "deprecate-atoms.md", "name": "Refactor test/stress/test_sse_concurrency_short.valk to remove atoms", "s": "p", "notes": "Same pattern as test/test_sse_concurrency_short.valk. 8 atoms to remove.", "accept": "grep -c atom test/stress/test_sse_concurrency_short.valk returns 0, test passes", "deps": ["t-wt8v"], "priority": "high"}
{"t": "task", "id": "t-0feb", "spec": "deprecate-atoms.md", "name": "Refactor test/stress/test_sse_concurrency.valk to remove atoms", "s": "p", "notes": "Same pattern as test/test_sse_concurrency_short.valk. 8 atoms to remove.", "accept": "grep -c atom test/stress/test_sse_concurrency.valk returns 0", "deps": ["t-62en"], "priority": "high"}
{"t": "task", "id": "t-e88w", "spec": "deprecate-atoms.md", "name": "Add deprecation warnings to atom builtins in parser.c", "s": "p", "notes": "Add VALK_WARN to valk_builtin_atom, valk_builtin_atom_get, valk_builtin_atom_set, valk_builtin_atom_add, valk_builtin_atom_sub.", "accept": "build/valk -e \"(atom 1)\" prints deprecation warning to stderr, make test passes", "deps": ["t-6nak", "t-0feb"], "priority": "high"}
{"t": "task", "id": "t-zeca", "spec": "deprecate-atoms.md", "name": "Remove valk_atom_t struct and builtin functions from parser.c", "s": "p", "notes": "Remove lines 4040-4100 (struct + 5 functions). Phase 5 breaking change.", "accept": "grep -c valk_atom_t src/parser.c returns 0, make build succeeds", "deps": ["t-e88w"], "priority": "high"}
{"t": "task", "id": "t-6nz8", "spec": "deprecate-atoms.md", "name": "Remove atom builtin registrations from parser.c", "s": "p", "notes": "Remove lines 5215-5219 where atom, atom/get, atom/set!, atom/add!, atom/sub! are registered.", "accept": "grep -c atom src/parser.c returns 0 (for builtin strings), make build succeeds", "deps": ["t-zeca"], "priority": "high"}
{"t": "task", "id": "t-78j9", "spec": "deprecate-atoms.md", "name": "Delete test/test_atom_builtins.valk", "s": "p", "notes": "File has 16 tests for atom API. All tests obsolete after atom removal.", "accept": "ls test/test_atom_builtins.valk fails", "deps": ["t-6nz8"], "priority": "high"}
{"t": "task", "id": "t-advn", "spec": "deprecate-atoms.md", "name": "Remove atom error tests from test/test_parser_errors.c", "s": "p", "notes": "Remove test_atom_get_wrong_type, test_atom_set_wrong_type, test_atom_add_wrong_type, test_atom_sub_wrong_type.", "accept": "grep -c atom test/test_parser_errors.c returns 0, make test passes", "deps": ["t-78j9"], "priority": "high"}
{"t": "task", "id": "t-abrr", "spec": "deprecate-atoms.md", "name": "Final verification: no atom references remain", "s": "p", "notes": "Verify: grep -r atom src/*.valk test/*.valk | grep -v atomic | wc -l returns 0. build/valk -e \"(atom 1)\" returns Unknown function error.", "accept": "make test passes, all acceptance criteria from spec phases 1-5 verified", "deps": ["t-advn"], "priority": "medium"}
{"t": "task", "id": "t-tfo1", "spec": "deprecate-atoms.md", "name": "Refactor *test-run-one-async* to use two-semaphore pattern (no atom)", "s": "p", "notes": "Replace the result-cell atom with a two-semaphore pattern: pass-sem and fail-sem. Create semaphores with count 1, immediately acquire both. done-fn releases the appropriate one. Use aio/race to wait for pass-sem acquire, fail-sem acquire, or timeout. This removes the atom while preserving the same behavior. Must test with a simple async test file.", "accept": "grep -c result-cell src/modules/test.valk returns 0, timeout 30 build/valk test/test_async_monadic_suite.valk passes", "priority": "high"}
{"t": "task", "id": "t-qwul", "spec": "deprecate-atoms.md", "name": "Run full test suite after *test-run-one-async* refactor", "s": "p", "notes": "After the two-semaphore refactor of *test-run-one-async*, run make test and verify all tests pass including the async test framework. If suite timeout occurs, debug the specific cause - likely an issue with the semaphore pattern or aio/race interaction.", "accept": "make test passes with no suite timeouts", "deps": ["t-tfo1"], "priority": "high"}
{"t": "reject", "id": "t-l7va", "done_at": "71398eb", "reason": "grep -c timed-out src/modules/test.valk returns 34 (not 0). Line 124 in *test-run-one-with-timeout* still contains functional code '(plist/set ctx :timed-out (+ (plist/get ctx :timed-out) 1))' that tracks timeout counts - this is not a string occurrence but actual atom-like state tracking."}
