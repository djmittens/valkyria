{"t": "spec", "spec": "deprecate-atoms.md"}
{"t": "task", "id": "t-g6kd61", "spec": "deprecate-atoms.md", "name": "Add deprecation warnings to atom builtins", "s": "p", "notes": "Add VALK_WARN deprecation warnings to all 5 atom builtins in src/parser.c (lines ~4040-4100): atom, atom/get, atom/set!, atom/add!, atom/sub!. Use VALK_WARN(\"atom is deprecated: use aio/semaphore or aio/then chains\") at the start of each builtin function", "accept": "Build succeeds and running (atom 1) prints deprecation warning to stderr", "priority": "high"}
{"t": "task", "id": "t-hfr17p", "spec": "deprecate-atoms.md", "name": "Refactor test framework to remove atoms", "s": "p", "notes": "Refactor src/modules/test.valk to replace all atom usage with functional patterns: 1) Remove 4 global atoms (*test-async-pending-atom*, *test-async-passed-atom*, *test-async-failed-atom*, *test-async-timed-out-atom*), 2) Replace polling loop (lines ~532-559) with aio/all to wait for test completion, 3) Replace per-test timeout atom with aio/race pattern, 4) Have each test return {:status :pass/:fail/:timeout} result, 5) Aggregate results after aio/all completes", "accept": "make test passes and grep -c atom src/modules/test.valk returns 0", "deps": ["t-g6kd61"], "priority": "high"}
{"t": "task", "id": "t-hnzo57", "spec": "deprecate-atoms.md", "name": "Refactor SSE stress tests to remove atoms", "s": "p", "notes": "Refactor test/stress/test_sse_concurrency_short.valk and test/stress/test_sse_concurrency.valk to replace 6 atoms each with functional patterns: 1) Replace counter atoms (connections-opened, connections-closed, events-received, errors-count) with aio/all to collect results from all connections, 2) Replace active-connections atom with aio/semaphore for rate limiting, 3) Replace test-running atom with aio/race for clean shutdown, 4) Return results from each connection and aggregate after aio/all", "accept": "All stress tests pass and grep -c atom for both files returns 0", "deps": ["t-hfr17p"], "priority": "high"}
{"t": "task", "id": "t-huv4b6", "spec": "deprecate-atoms.md", "name": "Update http2/client-request callers to use aio/then", "s": "p", "notes": "Although http2/client-request already returns handles, need to verify all callers use the handle-based API correctly. Search for any legacy callback-based usage patterns and update them to use aio/then with the returned handle. This is a verification task - the API is already correct", "accept": "All http2/client-request usages follow the handle pattern with aio/then", "priority": "medium"}
{"t": "task", "id": "t-h3mrv9", "spec": "deprecate-atoms.md", "name": "Remove atom implementation and tests", "s": "p", "notes": "Phase 5 - Breaking change: 1) Remove valk_atom_t struct and all atom builtin functions from src/parser.c (lines ~4040-4100), 2) Remove atom builtin registrations from valk_lenv_put_builtins (lines ~5209-5213), 3) Delete test/test_atom_builtins.valk file, 4) Remove atom error tests from test/test_parser_errors.c (lines ~1195-1215), 5) Verify no atom usage remains in any .valk files", "accept": "(atom 1) returns Unknown function atom error and make test passes", "deps": ["t-hnzo57"], "priority": "medium"}
