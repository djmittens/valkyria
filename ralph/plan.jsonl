{"t": "spec", "spec": "deprecate-atoms.md"}
{"t": "task", "id": "t-y5b5", "spec": "deprecate-atoms.md", "name": "Remove result-cell atom from *test-run-one-async*", "s": "p", "notes": "Replace atom-based result passing with a semaphore+closure pattern or alternative. Lines 404, 408, 426 use result-cell atom. Can use additional semaphore to signal result value, or restructure to avoid needing shared mutable state.", "accept": "grep -c result-cell src/modules/test.valk returns 0, make test passes", "kill": "timeout", "kill_log": "/home/xyzyx/src/valkyria/build/ralph-logs/ralph-20260120_095557-build.log", "priority": "high"}
{"t": "task", "id": "t-l7va", "spec": "deprecate-atoms.md", "name": "Remove timed-out atom from *test-run-one-with-timeout*", "s": "p", "notes": "Lines 117, 131 use a local timed-out atom to track per-test timeout state. Replace with aio/race pattern between test execution and timeout sleep. The function *test-timeout-cb* (lines 85-91) also uses timeout-atom parameter.", "accept": "grep -c timed-out src/modules/test.valk returns 0 (excluding string occurrences in output messages), make test passes", "priority": "high"}
{"t": "task", "id": "t-xpho", "spec": "deprecate-atoms.md", "name": "Remove *test-suite-timed-out* global atom", "s": "p", "notes": "Lines 9, 79, 305, 339 use *test-suite-timed-out* global atom. Replace with suite-level aio/race pattern. The atom is set in *test-suite-timeout-cb* and reset at start of test/run and test/run-with-timeout.", "accept": "grep -c test-suite-timed-out src/modules/test.valk returns 0, make test passes", "deps": ["t-y5b5", "t-l7va"], "priority": "high"}
{"t": "task", "id": "t-6nak", "spec": "deprecate-atoms.md", "name": "Verify test.valk has zero atoms and tests pass", "s": "p", "notes": "Final verification: grep -c atom src/modules/test.valk returns 0 AND make test passes.", "accept": "grep -c atom src/modules/test.valk returns 0, make test passes", "deps": ["t-xpho"], "priority": "high"}
{"t": "task", "id": "t-wt8v", "spec": "deprecate-atoms.md", "name": "Refactor test/test_sse_concurrency_short.valk to remove atoms", "s": "p", "notes": "Use aio/semaphore for rate limiting (MAX_ACTIVE=5), aio/all for result collection, stream/closed for stream state. 8 atoms to remove.", "accept": "grep -c atom test/test_sse_concurrency_short.valk returns 0, test passes", "priority": "high"}
{"t": "task", "id": "t-62en", "spec": "deprecate-atoms.md", "name": "Refactor test/stress/test_sse_concurrency_short.valk to remove atoms", "s": "p", "notes": "Same pattern as test/test_sse_concurrency_short.valk. 8 atoms to remove.", "accept": "grep -c atom test/stress/test_sse_concurrency_short.valk returns 0, test passes", "deps": ["t-wt8v"], "priority": "high"}
{"t": "task", "id": "t-0feb", "spec": "deprecate-atoms.md", "name": "Refactor test/stress/test_sse_concurrency.valk to remove atoms", "s": "p", "notes": "Same pattern as test/test_sse_concurrency_short.valk. 8 atoms to remove.", "accept": "grep -c atom test/stress/test_sse_concurrency.valk returns 0", "deps": ["t-62en"], "priority": "high"}
{"t": "task", "id": "t-e88w", "spec": "deprecate-atoms.md", "name": "Add deprecation warnings to atom builtins in parser.c", "s": "p", "notes": "Add VALK_WARN to valk_builtin_atom, valk_builtin_atom_get, valk_builtin_atom_set, valk_builtin_atom_add, valk_builtin_atom_sub.", "accept": "build/valk -e \"(atom 1)\" prints deprecation warning to stderr, make test passes", "deps": ["t-6nak", "t-0feb"], "priority": "high"}
{"t": "task", "id": "t-zeca", "spec": "deprecate-atoms.md", "name": "Remove valk_atom_t struct and builtin functions from parser.c", "s": "p", "notes": "Remove lines 4040-4100 (struct + 5 functions). Phase 5 breaking change.", "accept": "grep -c valk_atom_t src/parser.c returns 0, make build succeeds", "deps": ["t-e88w"], "priority": "high"}
{"t": "task", "id": "t-6nz8", "spec": "deprecate-atoms.md", "name": "Remove atom builtin registrations from parser.c", "s": "p", "notes": "Remove lines 5215-5219 where atom, atom/get, atom/set!, atom/add!, atom/sub! are registered.", "accept": "grep -c atom src/parser.c returns 0 (for builtin strings), make build succeeds", "deps": ["t-zeca"], "priority": "high"}
{"t": "task", "id": "t-78j9", "spec": "deprecate-atoms.md", "name": "Delete test/test_atom_builtins.valk", "s": "p", "notes": "File has 16 tests for atom API. All tests obsolete after atom removal.", "accept": "ls test/test_atom_builtins.valk fails", "deps": ["t-6nz8"], "priority": "high"}
{"t": "task", "id": "t-advn", "spec": "deprecate-atoms.md", "name": "Remove atom error tests from test/test_parser_errors.c", "s": "p", "notes": "Remove test_atom_get_wrong_type, test_atom_set_wrong_type, test_atom_add_wrong_type, test_atom_sub_wrong_type.", "accept": "grep -c atom test/test_parser_errors.c returns 0, make test passes", "deps": ["t-78j9"], "priority": "high"}
{"t": "task", "id": "t-abrr", "spec": "deprecate-atoms.md", "name": "Final verification: no atom references remain", "s": "p", "notes": "Verify: grep -r atom src/*.valk test/*.valk | grep -v atomic | wc -l returns 0. build/valk -e \"(atom 1)\" returns Unknown function error.", "accept": "make test passes, all acceptance criteria from spec phases 1-5 verified", "deps": ["t-advn"], "priority": "medium"}
