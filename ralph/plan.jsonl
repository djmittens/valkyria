{"t": "spec", "spec": "deprecate-atoms.md"}
{"t": "stage", "stage": "VERIFY"}
{"t": "task", "id": "t-s5xbz0", "name": "Refactor test_sse_builtins.valk to remove atoms", "spec": "deprecate-atoms.md", "s": "d", "notes": "Source: test/test_sse_builtins.valk lines 7,18-19,32. Replace atom for stream-closed-result with closure or handle pattern. Current: line 7 (atom false), line 18-19 (on-close callback sets atom), line 32 (atom/get check). Pattern: use stream/on-close with aio handle or closure variable. Spec ref: Phase 6 Remove Atoms, Stream close detection -> aio/cancel interval on close. Risk: timing of stream close callback.", "accept": "timeout 30 build/valk test/test_sse_builtins.valk exits 0 and grep -c atom test/test_sse_builtins.valk returns 0", "done_at": "848d049", "priority": "medium"}
{"t": "task", "id": "t-s7xixp", "name": "Delete test_atom_builtins.valk", "spec": "deprecate-atoms.md", "s": "p", "notes": "Source: test/test_atom_builtins.valk (entire file). Delete the file that tests atom API since atoms are being removed. Spec ref: Phase 6 Remove Atoms - test/test_atom_builtins.valk deleted. No refactoring needed, pure deletion.", "accept": "test ! -f test/test_atom_builtins.valk", "priority": "medium"}
{"t": "task", "id": "t-ta5ygc", "name": "Remove valk_atom_t and valk_builtin_atom* dead code from parser.c", "spec": "deprecate-atoms.md", "s": "p", "notes": "Source: src/parser.c lines 4040-4105. Remove typedef valk_atom_t struct and all 5 valk_builtin_atom* functions (atom, atom_get, atom_set, atom_add, atom_sub). These are already unregistered from valk_lenv_put_builtins but dead code remains. Also remove atom suppression from lsan_suppressions.txt lines 4-6. Spec ref: Phase 6 - valk_atom_t struct removed, All valk_builtin_atom* functions removed. Risk: none, code is unreachable.", "accept": "! grep -q valk_atom_t src/parser.c && ! grep -q valk_builtin_atom src/parser.c && make build", "priority": "medium"}
{"t": "task", "id": "t-tdxy7o", "name": "Refactor test_debug_handler.valk to remove atoms", "spec": "deprecate-atoms.md", "s": "p", "notes": "Source: test/test_debug_handler.valk - extensive atom usage throughout (50+ lines). Major refactor needed. Current uses: atom counters for tracking test state, atom flags for completion. Pattern: replace with aio/all for collecting test results, use test framework patterns from src/modules/test.valk. Spec ref: Phase 6 Remove Atoms. Risk: complex file with many atom operations, requires careful refactoring. May need to restructure test approach entirely.", "accept": "timeout 60 build/valk test/test_debug_handler.valk exits 0 and grep -c atom test/test_debug_handler.valk returns 0", "priority": "medium"}
{"t": "task", "id": "t-th0c0h", "name": "Fix SSE stress test closure environment capture", "spec": "deprecate-atoms.md", "s": "p", "notes": "Source: test/stress/test_sse_concurrency_short.valk and test_sse_concurrency.valk. Tests fail with Symbol not bound errors for =, >=, ==, aio/cancel inside aio/interval callbacks. Root cause: closures passed to aio/interval execute without access to prelude symbols. Need to investigate aio/interval callback environment in src/aio/aio_combinators.c. The callbacks should capture the lexical environment including prelude. Spec ref: Phase 5 - All stress tests pass. Risk: may be runtime bug in callback environment capture.", "accept": "timeout 60 build/valk test/stress/test_sse_concurrency_short.valk exits 0", "priority": "medium"}
{"t": "task", "id": "t-tkboqe", "name": "Refactor test_checkpoint_timer_stress.valk to remove atoms", "spec": "deprecate-atoms.md", "s": "p", "notes": "Source: test/stress/test_checkpoint_timer_stress.valk lines 7,9,16,20,33,37,44. Replace atom counter and test-passed flag with closure variables or handle-based patterns. Current: line 7,9 (atom defs), line 16,20 (atom operations in callbacks), line 33,37 (atom checks), line 44 (final check). Pattern: use def with closure mutation or aio/all. Spec ref: Phase 6 Remove Atoms. Risk: timing-dependent stress test may need careful refactoring.", "accept": "timeout 60 build/valk test/stress/test_checkpoint_timer_stress.valk exits 0 and grep -c atom test/stress/test_checkpoint_timer_stress.valk returns 0", "priority": "medium"}
{"t": "task", "id": "t-tnkpla", "name": "Refactor test_delta_baseline_isolation.valk to remove atoms", "spec": "deprecate-atoms.md", "s": "p", "notes": "Source: test/stress/test_delta_baseline_isolation.valk lines 158-160,162,164,167,171. Replace atom for interval cleanup coordination with aio/cancel pattern. Current: uses atom to signal interval stop on stream close. Pattern: store interval handle and call aio/cancel in stream/on-close handler (this is exactly the pattern from spec lines 98-101). Spec ref: Phase 6 Remove Atoms, Phase 3 aio/interval handle pattern.", "accept": "timeout 60 build/valk test/stress/test_delta_baseline_isolation.valk exits 0 and grep -c atom test/stress/test_delta_baseline_isolation.valk returns 0", "priority": "medium"}
{"t": "task", "id": "t-vmeioa", "name": "Investigate and fix hanging async tests", "spec": "deprecate-atoms.md", "s": "p", "notes": "Source: test/test_backpressure.valk, test/test_pending_streams.valk, test/test_concurrent_requests.valk, test/test_arena_out_of_order.valk. These tests hang with only memory tracking output shown. They do NOT use atoms (grep -c atom returns 0 for all). Root cause investigation needed: 1) Check if test framework test/run-async is broken, 2) Check if aio/stop is not being called, 3) Check event loop completion. Pattern: compare working test (test/test_aio_within.valk) vs hanging tests. Spec ref: Phase 4 - All existing async test files pass. Risk: may be fundamental async test framework issue.", "accept": "timeout 30 build/valk test/test_backpressure.valk exits 0", "priority": "medium"}
{"t": "accept", "id": "t-g6kd61", "done_at": "f391f6b", "reason": ""}
{"t": "accept", "id": "t-u9ur69", "done_at": "50a9603", "reason": ""}
{"t": "accept", "id": "t-veg2v6", "done_at": "8db5cdf", "reason": ""}
{"t": "accept", "id": "t-2gi2zz", "done_at": "4804ce8", "reason": ""}
{"t": "accept", "id": "t-2m2v3z", "done_at": "45cb699", "reason": ""}
{"t": "accept", "id": "t-g3srfg", "done_at": "16b8d7a", "reason": ""}
{"t": "accept", "id": "t-rm-sem", "done_at": "f25a51e", "reason": "aio/semaphore builtins removed"}
{"t": "accept", "id": "t-rm-deferred", "done_at": "6dc600e", "reason": "aio/deferred returns Unknown function error, make test passes", "name": "Remove aio/deferred builtins"}
{"t": "accept", "id": "t-aio-within", "done_at": "a6c6db1", "reason": "aio/within works, test exists, make test passes", "name": "Add aio/within combinator"}
{"t": "accept", "id": "t-interval", "done_at": "0e587de", "reason": "aio/interval returns handle, aio/cancel stops it, make test passes", "name": "Refactor aio/interval to return cancellable handle"}
{"t": "accept", "id": "t-4l8k3z", "done_at": "09f8f1a", "reason": "(aio/deferred) returns Unknown function error, make build and make test pass", "name": "Remove aio/deferred functions"}
{"t": "accept", "id": "t-aio-all-settled", "done_at": "d62fdb7", "reason": "aio/all-settled works, test exists, make test passes", "name": "Add aio/all-settled combinator"}
{"t": "accept", "id": "t-aio-retry", "done_at": "747a182", "reason": "aio/retry works with backoff, test exists, make test passes", "name": "Add aio/retry combinator", "timestamp": "2026-01-20T23:59:49-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Add (aio/retry aio fn opts) that: 1) Calls fn to get handle, 2) On failure, retries according to opts {:max-attempts n :backoff :exponential/:linear/:none :base-ms ms}, 3) Returns handle that completes with first success or final failure. Common pattern for network operations."}
{"t": "accept", "id": "t-sak2xw", "done_at": "1b2cd36", "reason": "aio/interval returns handle type, aio/cancel on interval handle exits code 0, callback returning :stop completes handle, make test passes", "name": "Refactor aio/interval to return handle", "timestamp": "2026-01-21T00:17:07-08:00", "changed_files": ["ralph/.current_task", "ralph/.runtime", "ralph/PROMPT_build.md", "ralph/PROMPT_decompose.md", "ralph/PROMPT_investigate.md", "ralph/PROMPT_plan.md", "ralph/PROMPT_verify.md", "ralph/plan.jsonl"], "notes": "Breaking change: Modify aio/interval in src/aio/aio_combinators.c to: 1) Return a handle instead of numeric ID, 2) Handle completes when interval is stopped (via :stop return or aio/cancel), 3) Make interval cancellable via aio/cancel, 4) Preserve existing :stop return pattern from callback function. Implementation: Replace interval ID tracking with handle-based approach."}
{"t": "accept", "id": "t-k4q13z", "done_at": "8b5c35b", "reason": "aio/within works with timeout, test exists, make test passes", "name": "Add aio/within combinator", "timestamp": "2026-01-21T00:30:38-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Add (aio/within handle timeout-ms) that: 1) Returns handle that fails with timeout error if handle does not complete in time, 2) Implementation in src/aio/aio_combinators.c using aio/race pattern internally, 3) Use aio/race with handle and sleep+timeout-error pattern, 4) Common timeout pattern replacement"}
{"t": "accept", "id": "t-aio-never", "done_at": "f28b542", "reason": "aio/never works, test exists, make test passes", "name": "Add aio/never combinator", "timestamp": "2026-01-21T00:40:39-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Add (aio/never aio) that returns a handle that never completes. Useful for aio/race patterns: (aio/race (list (aio/never aio) (stream/closed s))) means 'wait forever unless stream closes'. Simple implementation: create handle, never complete it."}
{"t": "accept", "id": "t-aio-traverse", "done_at": "4d28fee", "reason": "aio/traverse works, test exists, make test passes", "name": "Add aio/traverse combinator", "timestamp": "2026-01-21T00:48:17-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Add (aio/traverse list fn) as sugar for (aio/all (map fn list)). Maps async fn over list then collects results. Common pattern: (aio/traverse urls fetch) instead of (aio/all (map fetch urls))."}
{"t": "accept", "id": "t-4cpxzd", "done_at": "61028a4", "reason": "build/valk -e (aio/deferred aio) returns Unknown function error, make build succeeds, make test passes", "name": "Remove aio/deferred builtins", "timestamp": "2026-01-21T00:58:20-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Phase 1: Remove aio/deferred, aio/deferred-complete!, aio/deferred-fail! from src/aio/aio_combinators.c: 1) Remove valk_builtin_aio_deferred, valk_builtin_aio_deferred_complete, valk_builtin_aio_deferred_fail functions, 2) Remove their registrations from valk_lenv_put_builtins, 3) These are anti-pattern APIs that expose handle completion to Lisp code"}
{"t": "accept", "id": "t-ly03eq", "done_at": "8c9a97c", "reason": "make test passes and grep -c atom src/modules/test.valk returns 0", "name": "Refactor test framework to remove atoms", "timestamp": "2026-01-21T01:03:23-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Refactor src/modules/test.valk: 1) Remove 4 global atoms (*test-async-pending-atom*, etc), 2) Each test returns {:status :pass/:fail/:timeout} via handle, 3) Use aio/all to collect all test results, 4) Use aio/within for per-test timeout instead of atom coordination, 5) Aggregate results after aio/all completes"}
{"t": "accept", "id": "t-4qsj98", "done_at": "5d35593", "reason": "build/valk test/stress/test_sse_concurrency_short.valk runs without aio/then argument type errors", "name": "Fix create-batch function in SSE stress test", "timestamp": "2026-01-21T09:41:16-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Fix test/stress/test_sse_concurrency_short.valk:93-110 create-batch recursive function that returns Error instead of list. Replace recursive approach with manual handle list creation or proper loop. Root cause: recursion in Valkyria Lisp causing stack/evaluation issues."}
{"t": "accept", "id": "t-bp6h8x", "done_at": "db79573", "reason": "test/test_aio_within.valk exists and make test passes", "name": "Add missing aio/within test", "timestamp": "2026-01-21T09:54:02-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create test/test_aio_within.valk to test aio/within combinator functionality: 1) Test success case where handle completes before timeout, 2) Test timeout case where handle takes longer than timeout-ms, 3) Test error propagation when handle fails before timeout. Use aio/sleep to create predictable timing scenarios."}
{"t": "accept", "id": "t-bto1f2", "done_at": "63d83c7", "reason": "test/test_aio_never.valk exists and make test passes", "name": "Add missing aio/never test", "timestamp": "2026-01-21T10:13:17-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create test/test_aio_never.valk to test aio/never combinator: 1) Test that aio/never returns handle that never completes, 2) Test aio/race pattern with aio/never versus fast completing handle, 3) Test cancellation of aio/never handle. Use aio/race with quick aio/sleep to verify aio/never truly never completes."}
{"t": "accept", "id": "t-c2uad4", "done_at": "847f8bf", "reason": "build/valk -e (atom 1) returns Unknown function atom error and make build succeeds", "name": "Remove atom builtin registrations from parser.c", "timestamp": "2026-01-21T10:38:10-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Remove 5 atom builtin registrations from valk_lenv_put_builtins in src/parser.c lines ~5214-5218: atom, atom/get, atom/set!, atom/add!, atom/sub!. This makes atom functions unavailable without breaking compilation."}
{"t": "accept", "id": "t-eios0x", "done_at": "34a1ca4", "reason": "build/test_networking && build/test_aio_integration both exit with code 0", "name": "Run core networking tests for SSE verification", "timestamp": "2026-01-21T11:00:59-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Execute build/test_networking and build/test_aio_integration C test binaries to verify core async infrastructure. These C-level tests validate networking and AIO functionality that SSE depends on, without involving Valk-level atom dependencies."}
{"t": "accept", "id": "t-emzo2e", "done_at": "ccc5387", "reason": "timeout 15 build/valk test/test_sse_diagnostics_endpoint.valk exits with code 0", "name": "Test SSE diagnostics without atom dependencies", "timestamp": "2026-01-21T11:04:20-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Run timeout 15 build/valk test/test_sse_diagnostics_endpoint.valk to verify basic SSE endpoint functionality. Use timeout to prevent hanging. This tests SSE HTTP endpoints without atom-dependent stress testing."}
{"t": "accept", "id": "t-mkzozv", "done_at": "bf188af", "reason": "timeout 15 build/valk test/test_sse_diagnostics_endpoint.valk passes without 'Symbol not bound' errors", "name": "Replace atom usage in debug-broadcaster.valk with Valk variables", "timestamp": "2026-01-21T11:19:24-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "The debug-broadcaster module in src/modules/aio/debug-broadcaster.valk uses atom calls on lines 23-26 for state tracking (timer-running, subscriber-count, broadcast-tick, session-id). These must be replaced with regular Valk variables and mutable state management using aio/then chains or module-level state. The module tracks SSE subscriber state and broadcast coordination - this can be refactored to use regular def variables that are mutated through function calls rather than atom operations. The specific atom operations used are: (atom 0) for initialization, atom/get for reading, atom/set! for setting, and atom/add!/atom/sub! for incrementing/decrementing counters."}
{"t": "accept", "id": "t-q0hmfl", "done_at": "ac3d6ee", "reason": "grep -q \"aio/result.*aio/error\" src/aio/aio_combinators.c && make test passes && build/valk test/test_aio_within.valk shows all tests passing", "name": "Add aio/result and aio/error builtins for accessing async handle values", "timestamp": "2026-01-21T14:06:44-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "The Valk test suite cannot test actual timeout behavior because there are no builtins to access async handle results/errors synchronously. C tests access handle->result and handle->error directly, but Valk tests must rely on aio/catch which requires event loop processing. Add aio/result and aio/error builtins to src/aio/aio_combinators.c that return the result/error values from completed/failed async handles, enabling synchronous testing of timeout errors. Pattern: valk_builtin_aio_result should check handle status and return atomic_load(&handle->result), valk_builtin_aio_error should return atomic_load(&handle->error). Register both in valk_register_async_handle_builtins()."}
{"t": "accept", "id": "t-obqjio", "done_at": "b3b2bf2", "reason": "All Phase 2 combinators work: aio/within, aio/all-settled, aio/retry, aio/never, aio/traverse exist and make test passes", "name": "Verify Phase 2: async combinators are working", "timestamp": "2026-01-21T14:18:06-08:00", "changed_files": ["ralph/.current_task", "ralph/.runtime", "ralph/plan.jsonl", "src/aio/aio_combinators.c", "src/modules/test.valk", "test/test_aio_within.valk", "test_minimal_async.valk", "test_sync.valk"], "notes": "Check acceptance criteria lines 184-190: Search src/aio/aio_combinators.c for valk_builtin_aio_within/all_settled/retry/never/traverse functions, verify test files test/test_aio_*.valk exist for each combinator, run make test to confirm all pass. Based on tombstone accepted tasks t-aio-all-settled, t-aio-retry, t-aio-never, t-aio-traverse, these should all be present."}
{"t": "accept", "id": "t-9ncl3o", "done_at": "6832e9a", "reason": "build/valk test/test_aio_within.valk exits with code 0 and output contains test for timeout behavior", "name": "Add missing timeout behavior test to aio/within test suite", "timestamp": "2026-01-21T14:30:27-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Add test to test/test_aio_within.valk that verifies aio/within fails with :timeout error when operation times out. Test should create aio/within with long operation (aio/sleep sys 1000) and short timeout (50), then use test-async framework which properly runs event loop until completion. Expected result: handle status should be :failed and error should be :timeout. This addresses acceptance criteria aio/within works with timeout by actually testing the timeout path, not just handle creation."}
{"t": "accept", "id": "t-kzgf5n", "done_at": "88a7ec3", "reason": "timeout 10 build/valk -e (do (def {aio} (aio/start)) (aio/schedule aio 100 (\\ {} {(printf \"Timer fired\\n\") (aio/stop aio)}))) outputs Timer fired and exits code 0", "name": "Fix async system event loop processing for Valk script execution", "timestamp": "2026-01-21T15:16:47-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "CRITICAL: The async system works in C tests but hangs in Valk scripts. Root issue: event loop not processing timers/callbacks when aio/start creates system from Valk. Investigation needed: 1) Compare C test event loop setup (manual uv_run calls) vs Valk aio/start event loop thread setup, 2) Check if valk_aio_start_with_config properly initializes event loop thread for timer processing, 3) Verify GC coordination doesnt block event loop, 4) Fix test framework recursive polling in src/modules/test.valk (*test-run-async-one* function). Files: src/aio/system/aio_system.c, src/parser.c (aio/start), src/modules/test.valk"}
{"t": "accept", "id": "t-xr3t4i", "done_at": "c93b489", "reason": "grep -n valk_aio_enqueue_task.*__sleep_init src/aio/aio_combinators.c returns line 397 showing pattern is used", "name": "Verify aio/sleep thread-safety already done", "timestamp": "2026-01-21T19:01:43-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Run grep -n valk_aio_enqueue_task.*__sleep_init src/aio/aio_combinators.c to confirm valk_builtin_aio_sleep at lines 337-402 already uses task queue pattern. The __sleep_init_on_loop callback at lines 316-332 handles timer init on loop thread. No code changes needed - pure verification."}
{"t": "accept", "id": "t-xwu3h3", "done_at": "8be397d", "reason": "grep -n valk_aio_enqueue_task.*__within_init src/aio/aio_combinators.c returns line 2662 showing pattern is used", "name": "Verify aio/within thread-safety already done", "timestamp": "2026-01-21T19:06:35-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Run grep -n valk_aio_enqueue_task.*__within_init src/aio/aio_combinators.c to confirm valk_builtin_aio_within at line 2604 already uses task queue pattern. The __within_init_on_loop callback handles timer init on loop thread. No code changes needed - pure verification."}
{"t": "accept", "id": "t-yju699", "done_at": "23b5c10", "reason": "build/valk test/test_aio_within.valk output shows both sync tests (aio/within basic tests) AND async tests (aio/within timeout tests) running", "name": "Fix async test framework to run test/run-async tests", "timestamp": "2026-01-21T20:03:05-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "test/test_aio_within.valk has test/run-async block at lines 28-54 that never executes - only sync tests at lines 12-26 run. The problem is test/run calls aio/stop before test/run-async can execute. Fix src/modules/test.valk to ensure async tests run or restructure test file to use only test/run-async. Check *test-run-async-one* function in test.valk for polling issues."}
{"t": "accept", "id": "t-swv0dd", "done_at": "dd2c465", "reason": "timeout 30 build/valk test/test_aio_schedule_cancel.valk exits 0 and grep -c atom test/test_aio_schedule_cancel.valk returns 0", "name": "Refactor test_aio_schedule_cancel.valk to remove atoms", "timestamp": "2026-01-26T03:08:13-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Source: test/test_aio_schedule_cancel.valk lines 28,30,35,63,65,69. Remove atom/set!, atom/get, atom usage. Pattern: use closure variables or def to track state instead of atoms. Current uses: line 28 (atom 0), line 30 (atom/set!), line 35 (atom/get), line 63 (atom false), line 65 (atom/set!), line 69 (atom/get). Spec ref: Phase 6 Remove Atoms. Risk: closure variable mutation semantics differ from atoms."}
{"t": "accept", "id": "t-s046y3", "done_at": "9a8ed74", "reason": "timeout 30 build/valk test/test_gc_async_regression.valk exits 0 and grep -c atom test/test_gc_async_regression.valk returns 0", "name": "Refactor test_gc_async_regression.valk to remove atoms", "timestamp": "2026-01-26T11:21:56-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Source: test/test_gc_async_regression.valk lines 23,29-30,41. Replace atom counter with aio/all pattern. Current: line 23 (def atom for counter), line 29-30 (atom/add! in callback), line 41 (atom/get for final count). Pattern: use aio/all to collect callback completions instead of incrementing shared atom. Spec ref: Phase 6 Remove Atoms, Replacement Patterns table - Counters -> aio/all + reduce results. Risk: must ensure all callbacks complete before checking count."}
{"t": "accept", "id": "t-s2k1m0", "done_at": "c2cea83", "reason": "timeout 30 build/valk test/test_interval_cancel.valk exits 0 and grep -c atom test/test_interval_cancel.valk returns 0", "name": "Refactor test_interval_cancel.valk to remove atoms", "timestamp": "2026-01-26T11:40:36-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Source: test/test_interval_cancel.valk lines 7-8,14,28,47,62. Replace atom counter with handle-based aio/cancel pattern. Current: line 7-8 (atom defs), line 14,28,47 (atom/add!), line 62 (atom/get check). Pattern: since aio/interval now returns handle, use aio/cancel to stop interval. Track iterations via closure variable. Spec ref: Phase 6 Remove Atoms, Phase 3 aio/interval returns handle. Risk: interval handle completion semantics."}
{"t": "reject", "id": "t-huv4b6", "done_at": "e947aab", "reason": "Not all http2/client-request usages follow the handle pattern with aio/then."}
{"t": "reject", "id": "t-aio-retry", "done_at": "3571d12", "reason": "This was marked done by accident during testing", "name": "Add aio/retry combinator", "timestamp": "2026-01-20T23:53:34-08:00", "changed_files": ["ralph/.current_task", "ralph/.runtime", "src/aio/aio_combinators.c"], "notes": "Add (aio/retry aio fn opts) that: 1) Calls fn to get handle, 2) On failure, retries according to opts {:max-attempts n :backoff :exponential/:linear/:none :base-ms ms}, 3) Returns handle that completes with first success or final failure. Common pattern for network operations."}
{"t": "reject", "id": "t-k4q13z", "done_at": "a925b0f", "reason": "Missing test for actual timeout behavior. Acceptance criteria states 'aio/within works with timeout' but no test verifies that a slow operation (e.g., aio/sleep with longer duration than timeout) actually produces :timeout error. Tests only cover pre-timeout completion/failure cases.", "name": "Add aio/within combinator", "timestamp": "2026-01-21T00:15:28-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Add (aio/within handle timeout-ms) that: 1) Returns handle that fails with timeout error if handle does not complete in time, 2) Implementation in src/aio/aio_combinators.c using aio/race pattern internally, 3) Use aio/race with handle and sleep+timeout-error pattern, 4) Common timeout pattern replacement"}
{"t": "reject", "id": "t-mmwftu", "done_at": "bae6493", "reason": "The task was marked as done but the implementation is incorrect - async tests hang due to broken recursive polling logic", "name": "Fix async test framework polling to properly handle completion", "timestamp": "2026-01-21T11:43:58-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "The issue is in src/modules/test.valk lines 417-431. The *test-run-async-one* function uses aio/interval for polling test completion, but aio/interval only completes when returning :stop, not :continue. This breaks aio/within timeout handling. Replace the aio/interval polling with either: 1) recursive aio/schedule calls like the old atom-based version, or 2) modify aio/interval to support completing on :stop while still allowing :continue. The preferred approach is #1 since it matches the original working pattern and is simpler."}
{"t": "reject", "id": "t-741cnl", "done_at": "e684a86", "reason": "The async timeout test does not execute properly - it should take >10ms to run the timeout test but total runtime is only 0.034s. The async test framework appears to have issues with timeout mechanism at the Valkyria level, even though C-level tests pass.", "name": "Add proper async timeout test to test_aio_within.valk", "timestamp": "2026-01-21T15:41:21-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Replace the non-functional 'aio/within timeout behavior verification' test at lines 52-60 in test/test_aio_within.valk with a proper test-async test. The new test should: 1) Use test-async framework like other timeout tests, 2) Create aio/within with slow operation (aio/sleep sys 100) and short timeout (10), 3) Use aio/wait to wait for completion, 4) Verify handle status is :failed and error is :timeout. Follow pattern from test/test_async_http_handlers.valk line 721 for test-async structure."}
{"t": "reject", "id": "t-741cnl", "done_at": "14f86de", "reason": "Async timeout test never executes - test/run at lines 12-26 calls shutdown() before test/run-async can run", "name": "Add proper async timeout test to test_aio_within.valk", "timestamp": "2026-01-21T17:49:35-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Replace the non-functional 'aio/within timeout behavior verification' test at lines 52-60 in test/test_aio_within.valk with a proper test-async test. The new test should: 1) Use test-async framework like other timeout tests, 2) Create aio/within with slow operation (aio/sleep sys 100) and short timeout (10), 3) Use aio/wait to wait for completion, 4) Verify handle status is :failed and error is :timeout. Follow pattern from test/test_async_http_handlers.valk line 721 for test-async structure."}
{"t": "reject", "id": "t-5eqns4", "done_at": "2157d13", "reason": "Pure verification task with no buildable output - verification should be in acceptance criteria of implementation task"}
{"t": "reject", "id": "t-5mlz52", "done_at": "2157d13", "reason": "Pure cleanup task with no buildable output"}
{"t": "reject", "id": "t-dll7kt", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
{"t": "reject", "id": "t-fbj30b", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
{"t": "reject", "id": "t-fgit1q", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
{"t": "reject", "id": "t-fl9wlo", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
{"t": "reject", "id": "t-t9mlbl", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
{"t": "reject", "id": "t-zsh9nx", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
{"t": "reject", "id": "t-5nyi5y", "done_at": "2157d13", "reason": "Duplicate of t-dll7kt with no buildable output"}
{"t": "reject", "id": "t-42uiyw", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
{"t": "reject", "id": "t-8uu8yk", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
{"t": "reject", "id": "t-7hreg6", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
{"t": "reject", "id": "t-c02fy3", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
{"t": "reject", "id": "t-bq3n8t", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
{"t": "reject", "id": "t-8iuv8b", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
{"t": "reject", "id": "t-izq4xm", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
{"t": "reject", "id": "t-yr1qcs", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
{"t": "reject", "id": "t-otinnd", "done_at": "2157d13", "reason": "Pure verification task with no buildable output"}
