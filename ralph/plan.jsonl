{"t": "spec", "spec": "deprecate-atoms.md"}
{"t": "task", "id": "t-iufg", "spec": "deprecate-atoms.md", "name": "Implement aio/deferred builtin", "s": "d", "notes": "Add aio/deferred that returns {handle complete-fn fail-fn}. The handle is a pending async handle that can be completed by calling complete-fn with a value or fail-fn with an error. This enables callback-based APIs to integrate with aio/all. Add to src/aio/aio_combinators.c.", "accept": "test/test_aio_deferred.valk exists with tests, build/valk test/test_aio_deferred.valk passes, make test passes", "done_at": "fad034c", "priority": "high"}
{"t": "task", "id": "t-zfuj", "spec": "deprecate-atoms.md", "name": "Refactor test/test_sse_concurrency_short.valk to remove atoms", "s": "p", "notes": "Use aio/deferred to convert http2/client-request callbacks to handles. Use aio/semaphore for rate limiting (MAX_ACTIVE=5), aio/all for result collection. File currently has 33 atom references.", "accept": "grep -c atom test/test_sse_concurrency_short.valk returns 0, test passes", "deps": ["t-iufg"], "priority": "high"}
{"t": "task", "id": "t-kv1g", "spec": "deprecate-atoms.md", "name": "Refactor test/stress/test_sse_concurrency_short.valk to remove atoms", "s": "p", "notes": "Same pattern as test/test_sse_concurrency_short.valk using aio/deferred.", "accept": "grep -c atom test/stress/test_sse_concurrency_short.valk returns 0, test passes", "deps": ["t-zfuj"], "priority": "high"}
{"t": "task", "id": "t-cnr3", "spec": "deprecate-atoms.md", "name": "Refactor test/stress/test_sse_concurrency.valk to remove atoms", "s": "p", "notes": "Same pattern as test/test_sse_concurrency_short.valk using aio/deferred.", "accept": "grep -c atom test/stress/test_sse_concurrency.valk returns 0, test passes", "deps": ["t-kv1g"], "priority": "high"}
{"t": "task", "id": "t-azqw", "spec": "deprecate-atoms.md", "name": "Remove async test tracking atoms from test.valk", "s": "p", "notes": "Use aio/deferred to make each async test return a handle. Use aio/all to collect results. Lines 381-384 define *test-async-pending-atom*, *test-async-passed-atom*, *test-async-failed-atom*, *test-async-timed-out-atom*.", "accept": "grep -c test-async-pending-atom src/modules/test.valk returns 0, make test passes", "deps": ["t-iufg"], "priority": "high"}
{"t": "task", "id": "t-7ml6", "spec": "deprecate-atoms.md", "name": "Remove *test-suite-timed-out* global atom from test.valk", "s": "p", "notes": "Lines 9, 79, 295, 329, 500, 530 use *test-suite-timed-out* global atom. Replace with suite-level aio/race pattern.", "accept": "grep -c test-suite-timed-out src/modules/test.valk returns 0, make test passes", "deps": ["t-azqw"], "priority": "high"}
{"t": "task", "id": "t-sc0b", "spec": "deprecate-atoms.md", "name": "Verify test.valk has zero atoms and tests pass", "s": "p", "notes": "Final verification for test.valk refactor.", "accept": "grep -c atom src/modules/test.valk returns 0, make test passes", "deps": ["t-7ml6"], "priority": "high"}
{"t": "task", "id": "t-bfsj", "spec": "deprecate-atoms.md", "name": "Add deprecation warnings to atom builtins in parser.c", "s": "p", "notes": "Add VALK_WARN to valk_builtin_atom, valk_builtin_atom_get, valk_builtin_atom_set, valk_builtin_atom_add, valk_builtin_atom_sub.", "accept": "build/valk prints deprecation warning to stderr when atom is used, make test passes", "deps": ["t-sc0b", "t-cnr3"], "priority": "high"}
{"t": "task", "id": "t-howy", "spec": "deprecate-atoms.md", "name": "Remove valk_atom_t struct and builtin functions from parser.c", "s": "p", "notes": "Remove struct and 5 functions. Phase 5 breaking change.", "accept": "grep -c valk_atom_t src/parser.c returns 0, make build succeeds", "deps": ["t-bfsj"], "priority": "high"}
{"t": "task", "id": "t-62zu", "spec": "deprecate-atoms.md", "name": "Remove atom builtin registrations from parser.c", "s": "p", "notes": "Remove atom, atom/get, atom/set!, atom/add!, atom/sub! from valk_lenv_put_builtins.", "accept": "grep -c \"atom\" src/parser.c (for builtin registration) returns 0, make build succeeds", "deps": ["t-howy"], "priority": "high"}
{"t": "task", "id": "t-6iou", "spec": "deprecate-atoms.md", "name": "Delete test/test_atom_builtins.valk", "s": "p", "notes": "File tests atom API which no longer exists.", "accept": "ls test/test_atom_builtins.valk fails (file does not exist)", "deps": ["t-62zu"], "priority": "high"}
{"t": "task", "id": "t-pys4", "spec": "deprecate-atoms.md", "name": "Remove atom error tests from test/test_parser_errors.c", "s": "p", "notes": "Remove test_atom_get_wrong_type, test_atom_set_wrong_type, test_atom_add_wrong_type, test_atom_sub_wrong_type.", "accept": "grep -c atom test/test_parser_errors.c returns 0, make test passes", "deps": ["t-6iou"], "priority": "high"}
{"t": "task", "id": "t-9emo", "spec": "deprecate-atoms.md", "name": "Final verification: no atom references remain", "s": "p", "notes": "Verify grep -r atom src/*.valk test/*.valk | grep -v atomic returns 0 lines. Verify (atom 1) returns Unknown function error.", "accept": "make test passes, no atom references in valk files", "deps": ["t-pys4"], "priority": "medium"}
{"t": "reject", "id": "t-l7va", "done_at": "71398eb", "reason": "grep -c timed-out src/modules/test.valk returns 34 (not 0). Line 124 in *test-run-one-with-timeout* still contains functional code '(plist/set ctx :timed-out (+ (plist/get ctx :timed-out) 1))' that tracks timeout counts - this is not a string occurrence but actual atom-like state tracking."}
{"t": "reject", "id": "t-l7va", "done_at": "b0117aa", "reason": "Task misspecified: *test-run-one-with-timeout* never had a timed-out atom to remove. Line 124 uses :timed-out as a plist key (not an atom). The local timed-out atom (line 438) is in *test-start-async-one*, not this function. Acceptance criteria 'grep -c timed-out returns 0' is also incorrect - :timed-out plist keys are legitimate non-atom usages."}
